数据库和缓存双写一致性问题

如何保证数据库和缓存的双写一致性?
1.给缓存设置过期时间,可以保证最终一致性.缺点:时效太长.
2.先更新数据库,在更新缓存.
    缺点1:可能会出现并发问题.如A写入线程更新完数据库后,B写入线程再次更新数据库并更新缓存,A线程
        会将缓存数据更新回旧数据
    缺点2:缓存更新太过于频繁.如果读多写少,写请求还未到,缓存可能已经更新过很多次了.
3.先删除缓存,再更新数据库.
    缺点:同上,可能会出现并发问题.A写入线程先删缓存.B读取线程直接读取数据库并更新缓存,会将缓存更
        新为旧值.
    优化:可以采用双删策略,即更新数据库后等待一小段时间(如果是读写分离读会有延迟)再次删除缓存,不过
        会降低吞吐量.
4.先更新数据库,再删除缓存.
    缺点,依然有同3的缺点.但缓存失效时,A读取线程获取数据库中旧值,B写入线程写入数据库并删除缓存,
    A在缓存中写入旧值.不过读操作时间远低于写,出现几率低.解决办法同上
    
注意:假如缓存删除失败怎么办?
    假如重试机制,如果删除失败,将key放入消息队列中,通过异步程序重试.
    
    
        